<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Ukraine Control Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
/* ===== BASE ===== */
html, body {
    margin: 0;
    height: 100%;
}
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}
#map {
    height: 100%;
}

/* ===== LEAFLET PANES ===== */
.leaflet-pane.leaflet-tile-pane { z-index: 200; }
.leaflet-pane.leaflet-overlay-pane { z-index: 400; }
.leaflet-pane.leaflet-controlPane { z-index: 500; }
.leaflet-pane.leaflet-fortPane { z-index: 600; }

/* ===== LEFT BUTTONS ===== */
.rail-btn {
    position: absolute;
    left: 12px;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: #2c2c2c;
    color: #fff;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1200;
}
#left-info-btn { bottom: 80px; }
#left-settings-btn { bottom: 28px; }

/* ===== SETTINGS PANEL ===== */
#topright-controls {
    position: absolute;
    top: 10px;
    left: 64px;
    width: 300px;
    background: #ffffff;
    color: #111;
    border-radius: 14px;
    padding: 14px;
    font-size: 14px;
    box-shadow: 0 12px 32px rgba(0,0,0,.35);
    z-index: 1100;
    display: none;
}
#topright-controls strong {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: #777;
    margin: 14px 0 8px;
}
#topright-controls select {
    width: 100%;
    padding: 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

/* ===== TOGGLES ===== */
.control-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    font-size: 14px;
}
.control-row.sub {
    padding-left: 14px;
    color: #444;
}
.control-row input[type="checkbox"] {
    appearance: none;
    width: 44px;
    height: 24px;
    background: #cfcfcf;
    border-radius: 12px;
    position: relative;
    cursor: pointer;
}
.control-row input[type="checkbox"]::before {
    content: "";
    position: absolute;
    top: 3px;
    left: 3px;
    width: 18px;
    height: 18px;
    background: #fff;
    border-radius: 50%;
    transition: transform .2s;
}
.control-row input[type="checkbox"]:checked {
    background: #2f3146;
}
.control-row input[type="checkbox"]:checked::before {
    transform: translateX(20px);
}

/* ===== INFO PANEL ===== */
#info-overlay {
    position: absolute;
    bottom: 28px;
    left: 64px;
    width: 300px;
    max-height: 70%;
    background: rgba(255,255,255,0.97);
    border-radius: 12px;
    padding: 12px;
    display: none;
    flex-direction: column;
    gap: 10px;
    overflow-y: auto;
    box-shadow: 0 12px 32px rgba(0,0,0,.35);
    z-index: 1100;
}

/* ===== LEGEND ===== */
#legend {
    display: none;
    border-top: 1px solid #ddd;
    padding-top: 10px;
    font-size: 13px;
}
</style>
</head>

<body>

<div id="left-info-btn" class="rail-btn">i</div>
<div id="left-settings-btn" class="rail-btn">⚙️</div>

<div id="map"></div>

<div id="topright-controls">
    <strong>Base layer</strong>
    <select id="baselayer-select">
        <option value="googleHybrid">Hybrid</option>
        <option value="googleSatellite">Satellite</option>
        <option value="esriSatellite">ESRI</option>
        <option value="osm">OSM</option>
    </select>

    <strong>Defence lines</strong>
    <label class="control-row">Show defence lines
        <input type="checkbox" id="toggle-forts" checked>
    </label>
    <label class="control-row sub">Ditches <input type="checkbox" id="toggle-ditches" checked></label>
    <label class="control-row sub">Teeth <input type="checkbox" id="toggle-teeth" checked></label>
    <label class="control-row sub">Wire <input type="checkbox" id="toggle-wire" checked></label>
    <strong>Control</strong>
    <label class="control-row">Show control
        <input type="checkbox" id="toggle-control" checked>
    </label>
    <label class="control-row sub">Ukraine <input type="checkbox" id="toggle-ukraine" checked></label>
    <label class="control-row sub">Russia <input type="checkbox" id="toggle-russia" checked></label>
</div>

<div id="info-overlay">
    <strong>Notes</strong>
    <ol>
        <li>The map is based on information from sources in the field coming from both sides of the conflict and on DeepStateMap. The objective of the map is to be as accurate as possible while following the criteria listed in the legend.</li>
        <li>The following map cannot and does not represent with full accuracy the real situation on the front line. At this point in time, this war is not possible to draw on a map and is infinitely more complicated than polygons and lines. Please do not use this map for any serious purposes other than educational and informational. Because of this, please take into much higher consideration the information published on my X and Telegram profiles.</li>
        <li>Usage of the data contained in the map without my permission is strictly not allowed.</li>
        <li>Everything shown in the map complies with imposed OPSEC and is not showing in any way restricted and/or classified data. Both sides of the conflict are knowledgeable of what's shown in the map and possess either the same or better information than what the map is showing.</li>
        
    </ol>

    <div id="legend-toggle" style="cursor:pointer;font-weight:bold;">Legend</div>
    <div id="legend">
        <p><span style="background:#ca0000;width:14px;height:14px;display:inline-block;"></span> Consolidated Russian control: Russian forces have a sustained presence and have established permanent, manned positions. Parts of this area are not transferred into the gray zone unless one or more gray zone conditions are respected.</p>
        <p><span style="background:#377eb8;width:14px;height:14px;display:inline-block;"></span> Consolidated Ukrainian control: Ukrainian forces have a sustained presence and have established permanent, manned positions. Parts of this area are not transferred into the gray zone unless one or more gray zone conditions are respected.</p>
        <p><span style="background:#777;width:14px;height:14px;display:inline-block;"></span> Gray zone: The area is a no man’s land, contested, or mixed with positions from both sides.</p>
        <p><span style="background:#ffc300;width:14px;height:14px;display:inline-block;"></span> Ditches</p>
        <p><span style="background:#00ffff;width:14px;height:14px;display:inline-block;"></span> Dragon's teeth</p>
        <p><span style="background:#bcbcbc;width:14px;height:14px;display:inline-block;"></span> Concertina wire and "MZP Putanka" trip wire</p>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== MAP ===== */
const map = L.map('map', { preferCanvas: true })
    .setView([48.6857, 35.828], 6);

map.createPane('controlPane');
map.createPane('fortPane');

/* ===== BASE LAYERS ===== */
const baseLayers = {
    googleHybrid: L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}'),
    googleSatellite: L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}'),
    esriSatellite: L.tileLayer(
        'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
    ),
    osm: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
};
baseLayers.googleHybrid.addTo(map);

document.getElementById('baselayer-select').onchange = e => {
    Object.values(baseLayers).forEach(l => map.removeLayer(l));
    baseLayers[e.target.value].addTo(map);
};

/* ===== GEOJSON ===== */
const layers = {};
function addGeoJSON(url, name, options) {
    fetch(url)
        .then(r => r.json())
        .then(d => {
            layers[name] = L.geoJSON(d, options).addTo(map);
        });
}
